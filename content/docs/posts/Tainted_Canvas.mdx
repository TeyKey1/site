---
title: Resolving "Tainted canvases may not be exported" with Konva
sidebar_label: Tainted Canvas
hide_table_of_contents: true
slug: Tainted_Canvas.html
---

When you are trying to export a canvas you may have an error like:

> Unable to get data URL. Failed to execute 'toDataURL' on 'HTMLCanvasElement': Tainted canvases may not be exported.

> Unable to get image data from canvas because the canvas has been tainted by cross-origin data.

Or when you apply filters you can have this error:

> Unable to apply filter. Failed to execute 'getImageData' on 'CanvasRenderingContext2D': The canvas has been tainted by cross-origin data.

> Unable to apply filter. The operation is insecure.

## Why do we have that insecure error?

That is a [CORS error](https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image). For security reasons, a browser can mark a canvas as tainted when you load images from another domain. In that case the browser blocks canvas exporting into `dataURL` or `imageData` (that is what we are doing on export or when filters are used).

## How to fix CORS issue?

First you may try to set `crossOrigin = Anonymous` attribute of the loading image. This approach will work only if requested domain has an `Access-Control-Allow-Origin` headers that allow shared requests.

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

<Tabs>
  <TabItem value="Vanilla" default>
```js
import Konva from 'konva';

// Method 1: native image loading
const imageObj = new Image();
imageObj.onload = () => {
   const image = new Konva.Image({
     x: 50,
     y: 50,
     image: imageObj
   });
   layer.add(image);
};
imageObj.crossOrigin = 'Anonymous';
imageObj.src = url;

// Method 2: using Konva helper method
// crossOrigin is set automatically to Anonymous
Konva.Image.fromURL(url, (image) => {
  image.setAttrs({
    x: 50,
    y: 50
  });
  layer.add(image);
});
```
  </TabItem>
  <TabItem value="React">
```js
import { Stage, Layer, Image } from 'react-konva';
import useImage from 'use-image';

const MyImage = ({ url }) => {
  // useImage hook handles crossOrigin automatically
  const [image] = useImage(url, 'Anonymous');
  
  return (
    <Image
      x={50}
      y={50}
      image={image}
    />
  );
}

const App = () => {
  return (
    <Stage width={window.innerWidth} height={window.innerHeight}>
      <Layer>
        <MyImage url="your-image-url" />
      </Layer>
    </Stage>
  );
};
```
  </TabItem>
  <TabItem value="Vue">
```js
<template>
  <v-stage :config="stageSize">
    <v-layer>
      <v-image
        v-if="image"
        :config="{
          x: 50,
          y: 50,
          image: image
        }"
      />
    </v-layer>
  </v-stage>
</template>

<script setup>
import { useImage } from 'vue-konva';

const stageSize = {
  width: window.innerWidth,
  height: window.innerHeight
};

// useImage hook handles crossOrigin automatically
const [image] = useImage('your-image-url', 'Anonymous');
</script>
```
  </TabItem>
</Tabs>

### What if it doesn't work?

**It may still not work for all cases. If it doesn't work, then you have to configure your server in a different way (it is out of Konva scope) or you can try to store images somewhere else where CORS requests are supported.**